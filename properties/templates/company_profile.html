{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{ user.company_name }} | Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body>
    {% include 'NavBar.html' %}
    <!-- Banner -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #eef1f6;
        font-family: "Poppins", sans-serif;
        margin: 0;
      }
      .page-content {
        padding-bottom: 90px !important;
      }

      /* Banner */
      .page-content .banner {
        width: 100%;
        height: 260px;
        background-size: cover;
        background-position: center;
        border-bottom-left-radius: 14px;
        border-bottom-right-radius: 14px;
        margin-top: 70px;
      }

      /* Header section */
      .page-content .profile-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 60px;
        padding: 0 15px;
      }
      .page-content .logo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 5px solid #fff;
        object-fit: cover;
      }
      .page-content .company-info h2 {
        margin: 0;
        font-weight: 700;
      }
      .page-content .company-info p {
        margin: 0;
        color: #666;
      }

      /* Button group */
      .page-content .btn-group-custom button,
      .page-content .post-btn {
        margin-left: 10px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
      }
      .page-content .post-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 10px 18px;
      }

      /* Card */
      .page-content .card-box {
        border-radius: 12px;
        padding: 20px;
        background: #fff;
        margin-top: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      }

      /* Project toggle */
      .page-content .project-btn {
        background: #2563eb;
        color: #fff;
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
      }

      .page-content .list-group-item {
        border: none;
        margin-bottom: 10px;
        border-radius: 10px;
        background: #f6f8fc;
        padding: 15px;
        font-size: 15px;
        cursor: pointer;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      }
      .page-content .list-group-item:hover {
        background: #e2ebff;
      }

      /* ================= MOBILE CSS ONLY ================= */
      @media (max-width: 768px) {
        /* HEADER STACK */
        .page-content .profile-header {
          flex-direction: column !important;
          text-align: center !important;
          gap: 15px !important;
        }

        .page-content .profile-header > div:first-child {
          flex-direction: column !important;
          text-align: center !important;
          gap: 10px !important;
        }

        .page-content .logo {
          width: 110px;
          height: 110px;
        }

        .page-content .btn-group-custom {
          width: 100%;
          display: flex;
          justify-content: center;
          gap: 10px;
          margin-top: 10px;
          flex-wrap: wrap;
        }

        .page-content .btn-group-custom button,
        .page-content .post-btn {
          width: 100% !important;
          margin: 0 !important;
          padding: 12px !important;
          font-size: 15px;
        }

        /* PROJECT & REELS */
        .page-content .col-md-5 {
          width: auto !important;
          margin-bottom: 18px !important;
        }

        .page-content .card-box {
          margin-top: 18px !important;
          padding: 16px !important;
        }

        .page-content.project-btn {
          font-size: 15px !important;
          padding: 12px !important;
        }

        .list-group-item {
          font-size: 14px !important;
          padding: 12px !important;
        }

        /* OVERVIEW STATS */
        .page-content.card-box .row .col {
          font-size: 14px;
          margin-bottom: 10px;
        }

        /* OWNER STATS SECTION */
        .page-content .row.mt-3 .col {
          margin-bottom: 10px;
        }
      }

      /* Fix Bootstrap modal overriding */
      /* Fix mobile navbar + footer visibility */
      .navbar-mobile {
        z-index: 2500 !important;
      }

      .footer-nav {
        z-index: 2500 !important;
      }
      /* FIX FOOTER IN MOBILE VIEW */
      .footer-nav {
        position: fixed !important;
        bottom: 0 !important;
        left: 0;
        right: 0;
        height: 60px !important;
        background: white;
        display: flex !important;
        justify-content: space-around !important;
        align-items: center !important;
        border-top: 1px solid #ddd;
        z-index: 2500 !important;
      }

      .footer-nav div {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 12px;
      }
    </style>

    <div class="page-content">
      <div
        class="banner"
        style="background-image:url('/media/{{ profile_user.company_wallpaper_path }}')"
      ></div>

      <!-- HEADER -->
      <div class="container">
        <div class="profile-header">
          <div style="display: flex; align-items: center; gap: 18px">
            <img
              src="/media/{{ profile_user.company_logo_path }}"
              class="logo"
            />
            <div class="company-info">
              <h2>{{ profile_user.company_name }}</h2>
              <p>{{ profile_user.address }}</p>
            </div>
          </div>

          <!-- ACTION BUTTONS -->
          <div class="btn-group-custom">
            {% if is_owner %}
            <button
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#editModal"
            >
              Edit Profile
            </button>
            <a href="{% url 'prop:add_property' %}">
              <button class="post-btn">➕ Post Property</button>
            </a>
            {% else %}
            <button
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#contactModal"
            >
              Contact
            </button>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Overview -->
      <div class="container">
        <div class="card-box">
          <h6 class="text-muted mb-3">Company Overview</h6>
          <div class="row text-center">
            <div class="col">
              Experience<br /><strong>{{ profile_user.experience }}</strong>
            </div>
            <div class="col">
              Projects<br /><strong>{{ profile_user.total_projects }}</strong>
            </div>
            <div class="col">
              Ongoing<br /><strong>{{ profile_user.ongoing_projects }}</strong>
            </div>
            <div class="col">
              Completed<br /><strong
                >{{ profile_user.completed_projects }}</strong
              >
            </div>
          </div>
        </div>
      </div>

      <div class="container mt-3">
        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <!-- PROJECT LIST -->
          <div class="card-box" style="width: 350px">
            <button
              class="project-btn w-100"
              data-bs-toggle="collapse"
              data-bs-target="#projectList"
            >
              View All Projects
            </button>

            <div id="projectList" class="collapse mt-3">
              {% if projects %}
              <ul class="list-group">
                {% for p in projects %}
                <li class="list-group-item" style="position: relative">
                  <!-- SOLD BADGE -->
                  {% if p.status == "Sold" %}
                  <span
                    class="badge bg-danger"
                    style="
                      position: absolute;
                      top: 8px;
                      right: 8px;
                      font-size: 14px;
                      padding: 6px 10px;
                    "
                  >
                    Sold
                  </span>
                  {% endif %}

                  <!-- Project Info -->
                  <strong>Project Name: {{ p.projectName }}</strong><br />
                  <small>Location: {{ p.location }}</small><br />
                  <b>Price: ₹{{ p.price }}</b>

                  <!-- Buttons Section -->
                  {% if is_owner %}
                  <div class="mt-2 d-flex gap-2">
                    <!-- VIEW BUTTON -->
                    <a
                      href="{% url 'prop:property_detail' p.id %}"
                      class="btn btn-sm btn-primary"
                    >
                      View
                    </a>

                    <!-- SOLD BUTTON -->
                    {% if p.status != "Sold" %}
                    <a
                      href="{% url 'prop:mark_sold' p.id %}"
                      class="btn btn-sm btn-warning"
                    >
                      Mark as Sold
                    </a>
                    {% endif %}

                    <!-- DELETE BUTTON -->
                    <a
                      href="{% url 'prop:delete_project' p.id %}"
                      class="btn btn-sm btn-danger"
                      onclick="return confirm('Are you sure you want to delete this project?');"
                    >
                      Delete
                    </a>
                  </div>

                  {% else %}
                  <div class="mt-2">
                    <a
                      href="{% url 'prop:property_detail' p.id %}"
                      class="btn btn-sm btn-primary"
                      >View</a
                    >
                  </div>
                  {% endif %}
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="text-center text-muted">No projects posted yet</p>
              {% endif %}
            </div>
          </div>

          <!-- REELS LIST -->
          <div class="card-box" style="width: 350px">
            <button
              class="project-btn w-100"
              data-bs-toggle="collapse"
              data-bs-target="#reelList"
            >
              View Reels
            </button>

            <div id="reelList" class="collapse mt-3">
              {% if reels %}
              <ul class="list-group">
                {% for r in reels %}
                <li class="list-group-item">
                  <!-- Reel Info -->
                  <strong>{{ r.title }}</strong><br />
                  <small>Views: {{ r.views }}</small><br />

                  <div class="mt-2 d-flex gap-2">
                    <!-- View Reel -->
                    <a
                      href="{% url 'reel_detail' r.id %}"
                      class="btn btn-sm btn-primary"
                    >
                      View
                    </a>

                    {% if is_owner %}
                    <!-- Delete Reel -->
                    <a
                      href="{% url 'delete_reel' r.id %}"
                      class="btn btn-sm btn-danger"
                      onclick="return confirm('Are you sure you want to delete this reel?');"
                    >
                      Delete
                    </a>
                    {% endif %}
                  </div>
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="text-center text-muted">No reels uploaded yet</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Stats: visible only to Owner -->
      {% if is_owner %}
      <div class="container">
        <div class="row mt-3">
          <div class="col">
            <div class="card p-3 text-center">
              <h5>Views</h5>
              <h3>{{ profile_user.click }}</h3>
            </div>
          </div>
          <div class="col">
            <div class="card p-3 text-center">
              <h5>Leads</h5>
              <h3>{{ contact_count }}</h3>
            </div>
          </div>
        </div>
      </div>

      <!-- Subscription only for owner -->
      <div class="container">
        <div class="card-box">
          <h6 class="text-muted mb-3">Subscription</h6>
          <div class="row text-center">
            <div class="col">
              Amount<br /><strong
                ><br />
                ₹{{profile_user.company_subscription_type|default:"None"}}</strong
              >
            </div>
            <div class="col">
              Duration<br /><strong
                >{{ profile_user.selected_duration }} Months</strong
              >
            </div>
            <div class="col">
              Expires<br /><strong>
                <br />
                {{ profile_user.company_subscription_end_date}}</strong
              >
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <br /><br /><br />

      <!-- ================= MODAL: EDIT PROFILE ================= -->
      {% if is_owner %}
      <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="modal-header">
                <h5>Edit Profile</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <div class="modal-body">
                <input
                  type="file"
                  name="company_wallpaper_path"
                  class="form-control mb-2"
                />
                <input
                  type="file"
                  name="company_logo_path"
                  class="form-control mb-2"
                />

                <input
                  type="email"
                  name="email"
                  value="{{ profile_user.email }}"
                  class="form-control mb-2"
                  placeholder="Email"
                />
                <input
                  type="text"
                  name="company_name"
                  value="{{ profile_user.company_name }}"
                  class="form-control mb-2"
                  placeholder="Company Name"
                />
                <input
                  type="number"
                  name="experience"
                  value="{{ profile_user.experience }}"
                  class="form-control mb-2"
                  placeholder="Experience"
                />
                <input
                  type="number"
                  name="total_projects"
                  value="{{ profile_user.total_projects }}"
                  class="form-control mb-2"
                  placeholder="Total Projects"
                />
                <input
                  type="number"
                  name="ongoing_projects"
                  value="{{ profile_user.ongoing_projects }}"
                  class="form-control mb-2"
                  placeholder="Ongoing Projects"
                />
                <input
                  type="number"
                  name="completed_projects"
                  value="{{ profile_user.completed_projects }}"
                  class="form-control mb-2"
                  placeholder="Completed Projects"
                />
                <input
                  type="text"
                  name="address"
                  value="{{ profile_user.address }}"
                  class="form-control mb-2"
                  placeholder="Address"
                />
                <input
                  type="text"
                  name="contact_number"
                  value="{{ profile_user.contact_number }}"
                  class="form-control mb-2"
                  placeholder="Contact Number"
                />
              </div>

              <div class="modal-footer">
                <button
                  type="button"
                  class="btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="submit-btn">Save</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endif %}
      <!-- ================= MODAL: CONTACT FOR VISITORS ONLY ================= -->
      {% if not is_owner %}
      <div class="modal fade" id="contactModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="POST" action="{% url 'prop:contact_submit' %}">
              {% csrf_token %}
              <div class="modal-header">
                <h5>Contact {{ profile_user.company_name }}</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <div class="modal-body">
                <input
                  type="hidden"
                  name="contact_id"
                  value="{{ profile_user.id }}"
                />

                <input
                  type="text"
                  name="contact_name"
                  placeholder="Your Name"
                  class="form-control mb-2"
                  required
                />

                <input
                  type="email"
                  name="email"
                  placeholder="Email"
                  class="form-control mb-2"
                  required
                />

                <input
                  type="text"
                  name="requirement"
                  placeholder="Requirement (e.g., 2BHK, Office Space, etc.)"
                  class="form-control mb-2"
                  required
                />

                <textarea
                  name="message"
                  placeholder="Message"
                  class="form-control mb-2"
                  required
                ></textarea>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">
                  Send Message
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% endif %} {% include 'footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>